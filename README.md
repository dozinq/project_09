# ğŸ“Œ My Ninth Project ğŸ“‹

---

##### - Outline : 2022ë…„ 4ì›” 22ì¼, ì•„í™‰ë²ˆì§¸ ê´€í†µ í”„ë¡œì íŠ¸ë¥¼ ìˆ˜í–‰í•˜ì˜€ë‹¤. ì´ì œ ì •ë§ ì–¼ë§ˆ ë‚¨ì§€ ì•Šì•˜ë‹¤ê³  ìƒê°ì´ ë“ ë‹¤. ë‹¤ìŒì£¼ì— ë§ˆì§€ë§‰ ê´€í†µí”„ë¡œì íŠ¸ë¥¼ ìˆ˜í–‰í•˜ë©´, ìµœì¢…í”„ë¡œì íŠ¸ë§Œ ì•ë‘ê³  ìˆê²Œ ë  ê²ƒì´ë‹¤. ê·¸ëŸ¬ë©´ì„œ ì˜¤ëŠ˜ ëŠê¼ˆë˜ ì ì— ëŒ€í•´ ê°„ë‹¨í•˜ê²Œ ì—¬ê¸°ì— ì ì–´ë³´ë„ë¡ í•˜ê² ë‹¤.

#####  ì˜¤ëŠ˜ í”„ë¡œì íŠ¸ëŠ” ì¡°ê¸ˆ íŠ¹ì´í•˜ë‹¤ê³  ëŠê»´ì¡Œë˜ ì ì´ ìˆì—ˆë‹¤. ì–´ëŠ ì •ë„ ììœ¨ì„±ì´ ë³´ì¥ë˜ì–´ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤. ê·¸ ë§ì€ ê³§ ê¸°ëŠ¥ ë©´ì— ìˆì–´ì„œëŠ” ì‘ë™ì´ ë  ìˆ˜ ìˆê²Œë” ì‘ì„±í•˜ë˜, ê·¸ ì™¸ëŠ” ëª¨ë“  ê²ƒì´ íŒ€ ë³„ë¡œ ììœ ë¡­ê²Œ êµ¬ì„±í•˜ë¼ëŠ” ëœ»ì´ì—ˆë‹¤. ì˜ˆë¥¼ ë“¤ìë©´, ì ì ˆí•œ ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•˜ì—¬ ì˜í™”ë¥¼ ì¶”ì²œí•  ìˆ˜ ìˆê²Œ í•œë‹¤ëŠ” ê²ƒì´ ê·¸ëŸ¬í•˜ì˜€ë‹¤. ê·¸ë ‡ê¸°ì— ë” íŒ€ì›ê³¼ ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆŒ ìˆ˜ ìˆê²Œ ëœ ê²ƒ ê°™ê³ , ì„œë¡œ ìƒê°ì„ ë‚˜ëˆŒ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ ê³§ ê°œë°œì´ì§€ ì•Šì„ê¹Œ ìƒê°ì„ í–ˆë˜ ë‚ ì´ê¸°ë„ í•˜ì˜€ë‹¤.

#####  ì˜¤ëŠ˜ í”„ë¡œì íŠ¸ë¥¼ í•˜ë©´ì„œ ëŠë‚€ ì ë¶€í„° í•œ ì¤„ë¡œ ê°„ë‹¨í•˜ê²Œ ë§í•˜ìë©´, 'ì£¼ë§ë™ì•ˆ ë§ì€ ë³µìŠµì„ í†µí•´ ë” ë§ì€ ë„ì›€ì´ ë˜ì–´ì£¼ê³  ì‹¶ë‹¤.' ì˜€ë‹¤. ì˜¤ëŠ˜ì€ ê°™ì€ ë°˜ì˜ 'ê³ ì€ë¯¼' í•™ìš°ì™€ í˜ì–´ë¥¼ ì´ë£¨ì–´ í”„ë¡œì íŠ¸ë¥¼ ìˆ˜í–‰í•˜ì˜€ê³ , ê·¸ ê³¼ì • ì†ì—ì„œ ëŠë‚€ ì ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì„œìˆ í•´ ë³´ê³ ì í•œë‹¤. ë˜í•œ ê°œì„ í•´ì•¼ í•˜ëŠ” ë¶€ë¶„ë„ ì‘ì„±í•´ë³´ë ¤ í•œë‹¤.

---

<br>


# **< Title : "ì•Œê³ ë¦¬ì¦˜ì„ ì ìš©í•œ ì„œë²„ êµ¬ì„±" >**

*(This project was carried out in **Python 3.9.9 and Django 3.2.12 environment .**)*

- *ìš”êµ¬ì‚¬í•­ : ì»¤ë®¤ë‹ˆí‹° ì„œë¹„ìŠ¤ì˜ ìƒì„¸ ê¸°ëŠ¥ ê°œë°œì„ ìœ„í•œ ë‹¨ê³„ë¡œ, ë¹„ë™ê¸° í†µì‹ (AJAX)ì„ í™œìš©í•˜ì—¬ ì‚¬ìš©ìì˜ UI/UXë¥¼ ê°œì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.*

---

*(í”„ë¡œì íŠ¸ íŒŒì¼ì˜ settings.py, urls.pyì™€ base.html ë“±ì˜ ê¸°ë³¸ ì„¤ì •ì€ ì œì™¸í•˜ê³  , ì•± íŒŒì¼ì— ê´€í•´ì„œë§Œ ì‘ì„±í•©ë‹ˆë‹¤.)*

<br>

- **ìœ ì € íŒ”ë¡œìš° ê¸°ëŠ¥ êµ¬í˜„**

  - **accounts/views.py**

    ```python
    # follow ê¸°ëŠ¥ì— ëŒ€í•´ì„œë§Œ ì‘ì„±.
    
    @require_POST
    def follow(request, user_pk):
        followed = False
        if request.user.is_authenticated:
            person = get_object_or_404(get_user_model(), pk=user_pk)
            user = request.user
            if person != user:
                if person.followers.filter(pk=user.pk).exists():
                    person.followers.remove(user)
                else:
                    person.followers.add(user)
                    followed = True
            context = {
                'followed': followed,
                'followerCount': user.followers.count(),
                'followingCount': user.followings.count(),
            }
            return JsonResponse(context)
        return redirect('accounts:login')
    ```

  - **accounts/profile.html**

    ```python
    {% extends 'base.html' %}
    
    {% block content %}
      <h1>{{ person.username }}ì˜ í”„ë¡œí•„ í˜ì´ì§€</h1>
      {% with followings=person.followings.all followers=person.followers.all %}
        <div>
          <div id='follow-count'>
            íŒ”ë¡œì‰ : {{ followings|length }} / íŒ”ë¡œì›Œ : {{ followers|length }}
          </div>
          {% if request.user != person %}
            <div>
              <form action="{% url 'accounts:follow' person.pk %}" id="follow-form" method="POST" data-user-id="{{ person.pk }}">
                {% if request.user.is_authenticated %}
                  {% csrf_token %}
                {% endif %}
                {% if request.user in followers %}
                  <button id="followBtn">ì–¸íŒ”ë¡œìš°</button>
                {% else %}
                  <button id="followBtn">íŒ”ë¡œìš°</button>
                {% endif %}
              </form>
            </div>
          {% endif %}
        </div>
      {% endwith %}
    {% endblock %}
    
    {% block script %}
    <script>
      const followForm = document.querySelector('#follow-form')
      const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]')
    
      if (followForm) {
        followForm.addEventListener('submit', event => {
          if (csrf_token) {
            event.preventDefault()
            const userId = event.target.dataset.userId
            axios({
              method: 'post',
              url: `http://127.0.0.1:8000/accounts/${userId}/follow/`,
              headers : {'X-CSRFToken': csrftoken.value},
            })
            .then(response => {
              const input = document.querySelector('#followBtn')
              if (response.data.followed) {
                input.innerText = 'ì–¸íŒ”ë¡œìš°'
              } else {
                input.innerText = 'íŒ”ë¡œìš°'
              }
              
              const followCount = document.querySelector('#follow-count')
              followCount.innerText = `íŒ”ë¡œì‰ : ${response.data.followingCount} / íŒ”ë¡œì›Œ : ${response.data.followerCount}`
            })
          }
        })
      }
    </script>
    {% endblock script %}
    ```

<br>

- **ë¦¬ë·° ì¢‹ì•„ìš” ê¸°ëŠ¥ êµ¬í˜„**

  - **community/views.py**

    ```python
    # like ê¸°ëŠ¥ì— ëŒ€í•´ì„œë§Œ ì‘ì„±.
    
    @require_POST
    def like(request, review_pk):
        if request.user.is_authenticated:
            review = get_object_or_404(Review, pk=review_pk)
            user = request.user
            if review.like_users.filter(pk=user.pk).exists():
                review.like_users.remove(user)
                liked = False
            else:
                review.like_users.add(user)
                liked = True
            context = {
                'liked': liked,
                'count': review.like_users.count(),
            }
            return JsonResponse(context)
        return redirect('accounts:login')
    ```

  - **community/index.html**

    ```python
    {% extends 'base.html' %}
    
    {% block content %}
      <h1>Community</h1>
      <hr>
      {% for review in reviews %}
        <p>ì‘ì„±ì : <a href="{% url 'accounts:profile' review.user.username %}">{{ review.user }}</a></p>
        <p>ê¸€ ë²ˆí˜¸: {{ review.pk }}</p>
        <p>ê¸€ ì œëª©: {{ review.title }}</p>
        <p>ê¸€ ë‚´ìš©: {{ review.content }}</p>
        <form action="{% url 'community:like' review.pk %}" method="POST" class="d-inline like-form" data-review-id="{{ review.pk }}">
          {% csrf_token %}
          {% if user in review.like_users.all %}
            <button id="like-{{ review.pk }}">ì¢‹ì•„ìš” ì·¨ì†Œ</button>
          {% else %}
            <button id="like-{{ review.pk }}">ì¢‹ì•„ìš”</button>
          {% endif %}
        </form>
        <p>
          <span id="like-count-{{ review.pk }}">
            {{ review.like_users.all|length }}
          </span>
          ëª…ì´ ì´ ê¸€ì„ ì¢‹ì•„í•©ë‹ˆë‹¤.
        </p>
        <a href="{% url 'community:detail' review.pk %}">[detail]</a>
        <hr>
      {% endfor %}
    {% endblock %}
    
    
    {% block script %}
    <script>
      const likeForms = document.querySelector('.like-form')
      const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]')
      likeForms.forEach(form => {
        forms.addEventListener('submit', event => {
          event.preventDefault()
          const reviewId = event.target.dataset.reviewId
          axios({
            method: 'post',
            url: `http://127.0.0.1:8000/community/${reviewId}/like/`,
            headers : {'X-CSRFToken': csrftoken.value},
          })
          .then(response => {
            const likeCount = document.querySelector(`#like-count-${reviewId}`)
            likeCount.innerText = response.data.count
            const button = document.querySelector(`#like-${reviewId}`)
            if (response.data.liked) {
              button.innerText = 'ì¢‹ì•„ìš” ì·¨ì†Œ'
            } else {
              button.innerText = 'ì¢‹ì•„ìš”'
            }
          })
        })
      })
    </script>
    {% endblock script %}
    ```

<br>

- **ì‚¬ìš©ìì˜ ì¸ì¦ ì—¬ë¶€ì™€ ê´€ê³„ì—†ì´, ì „ì²´ ì˜í™” ëª©ë¡ ì¡°íšŒ í˜ì´ì§€ì—ì„œ ì˜í™” ëª©ë¡ì„ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ êµ¬í˜„**

  - **movies/views.py**

    ```python
    # ëª©ì ì— ë§ëŠ” ì½”ë“œë§Œ ì‘ì„±.
    
    @require_safe
    def index(request):
        movies = Movie.objects.order_by('-popularity')
        paginator = Paginator(movies, 10)
        page_number = request.GET.get('page')
        # queryset
        page_obj = paginator.get_page(page_number)
        
        context = {
            'movies': page_obj,
        }
        return render(request, 'movies/index.html', context)
    ```

  - **movies/index.html**

    ```python
    {% extends 'base.html' %}
    {% load bootstrap5 %}
    {% block content %}
      <h1>Movies</h1>
    
      <div id="movieList">
        {% for movie in movies %}
        <div class="movie">
          <h2>{{ movie.title }}</h2>
          <p>{{ movie.overview }}</p>
          <a href="{% url 'movies:detail' movie.pk %}">[DETAIL]</a>
          <hr>
        </div>
        {% endfor %}
    
        <!-- ì—¬ê¸°ì— JSON ë‚´ìš©ì„ ë‹´ì€ Element append -->
      </div>
    
    {% comment %} 
      <div class="d-flex justify-content-center">
        {% bootstrap_pagination movies %}
      </div> {% endcomment %}
    {% endblock %}
    
    {% block script %}
    <script>
      let page = 2
      const movieList = document.querySelector('#movieList')
    
      document.addEventListener('scroll', function (event) {
        const { scrollTop, clientHeight, scrollHeight } = document.documentElement
        // ì™„ì „ ë°”ë‹¥ì— ë„ë‹¬
        // if (scrollHeight - scrollTop === clientHeight) {
    
        // 1. ìŠ¤í¬ë¡¤ì´ ë°”ë‹¥(ì–¸ì €ë¦¬)ì— ë„ë‹¬ í–ˆì„ë•Œ, => document / event 
        if (scrollTop + clientHeight >= scrollHeight - 5) {
          // 2. ì¶”ê°€ ë°ì´í„° 10ê°œë¥¼ ë¶ˆëŸ¬ì˜´(AJAX) => axios / DRF
          axios({
            method: 'get',
            url: `/movies/ajax/?page=${page}`
          })
            .then(res => {
                const movies = res.data
                // 3. ì‘ë‹µ JSON ë°ì´í„° 10ê°œë¥¼ í™”ë©´ì— ë¶™ì„
                movies.forEach(movie => {
                  const movieDiv = document.createElement('div')
    
                  const h2 = document.createElement('h2')
                  h2.innerText = movie.title
    
                  const p = document.createElement('p')
                  p.innerText = movie.overview
    
                  const a = document.createElement('a')
                  a.innerText = '[DETAIL]'
                  a.href = `/movies/${movie.id}/`
    
                  const hr = document.createElement('hr')
    
                  movieDiv.append(h2, p, a, hr)
                  movieList.appendChild(movieDiv)
                })
                page++
              })
              .catch(err => console.error(err))
        }
      })
    </script>
    {% endblock script %}
    ```
    
  

<br>

- **ì‚¬ìš©ìì˜ ì¸ì¦ ì—¬ë¶€ì™€ ê´€ê³„ì—†ì´, ë‹¨ì¼ ì˜í™” ìƒì„¸ ì¡°íšŒ í˜ì´ì§€ì—ì„œ ì˜í™” ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ êµ¬í˜„**

  - **movies/views.py**

    ```python
    # ëª©ì ì— ë§ëŠ” ì½”ë“œë§Œ ì‘ì„±.
    
    @require_safe
    def detail(request, movie_pk):
        movie = get_object_or_404(Movie, pk=movie_pk)
        context = {
            'movie': movie,
        }
        return render(request, 'movies/detail.html', context)
    ```

  - **movies/detail.html**

    ```python
    {% extends 'base.html' %}
    
    {% block content %}
      <h2 class="text-center">DETAIL</h2>
      <h3>{{ movie.pk }} ë²ˆì§¸ ê¸€</h3>
      <hr>
      <p>title: {{ movie.title }}</p>
      <p>release_date: {{ movie.release_date }}</p>
      <p>popularity: {{ movie.popularity }}</p>
      <p>vote_count: {{ movie.vote_count }}</p>
      <p>vote_average: {{ movie.vote_average }}</p>
      <p>overview: {{ movie.overview }}</p>
      <p>
        <img src="{{ movie.poster_path }}" alt="">
      </p>
      <hr>
      <a href="{% url 'movies:index' %}">[back]</a>
    {% endblock  %}
    ```

<br>

- **ì‚¬ìš©ìê°€ ì¸ì¦ë˜ì–´ ìˆë‹¤ë©´, 10ê°œì˜ ì˜í™”ë¥¼ ì¶”ì²œí•˜ì—¬ ì œê³µí•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ êµ¬í˜„**

  - **movies/views.py**

    ```python
    @require_safe
    def recommended(request):
        if request.user.is_authenticated:
            movies = Movie.objects.order_by('-vote_average')[:10]
            context = {
                'movies': movies,
            }
            return render(request, 'movies/recommended.html', context)
        return redirect('accounts:login')
    ```

  - **movies/recommended.html**

    ```python
    {% extends 'base.html' %}
    
    {% block content %}
      <h2 class="text-center">ì˜í™” ì¶”ì²œ</h2>
      {% for movie in movies  %}
        <a href="{% url 'movies:detail' movie.pk %}">{{ movie.title }}</a>
        <hr>
      {% endfor %}
    {% endblock %}
    ```

<br>

---







